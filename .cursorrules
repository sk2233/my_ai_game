# 项目基本信息

## 项目概述
- **项目名称**: 雪莉酱の大冒险
- **项目类型**: 2D 横版跳跃游戏（类似超级马里奥）
- **开发框架**: Ebiten v2
- **编程语言**: Go 1.24+

## 游戏配置
- **窗口尺寸**: 1280 × 720 像素
- **窗口标题**: 雪莉酱の大冒险
- **窗口调整**: 不可调整大小（WindowResizingModeDisabled）
- **地图块数量**: 512 块（在 main.go 中 NewGame(512) 设置）
- **地图单元宽度**: 120 像素

## 项目结构
- `main.go`: 程序入口，负责窗口初始化和游戏启动
- `game.go`: Game 结构体，实现 ebiten.Game 接口，包含游戏主循环、资源管理、相机系统
- `map.go`: 地图生成逻辑，包含 MapItem 结构体和 GenMap 函数
- `player.go`: 玩家实体，处理移动、重力、跳跃、碰撞、动画状态机、死亡逻辑、飞行状态
- `obstacle.go`: 障碍物类（统一处理道路、障碍物、怪物、道具），包含 ObstacleType 枚举
- `collision.go`: 碰撞检测工具，包含 CollisionBox 接口和 CheckCollision 函数
- `animation.go`: 动画系统，包含 Animation 和 AnimationController，管理帧动画和状态机
- `audio.go`: 音频管理器，封装背景音乐和音效的加载与播放

## 游戏系统

### 地图生成系统 (`map.go`)
- **MapItem 结构体**:
  - `Index`: 列索引（从左往右）
  - `HasRoad`: 是否有道路
  - `HasObstacle`: 是否有障碍物（仅当有道路时）
  - `HasMonster`: 是否有怪物（仅当有道路且无障碍物时）
  - `HasTool`: 是否有道具（独立概率）
- **生成规则**:
  - 前 10 块地图必须有道路（防止角色掉下去）
  - 道路概率：80%（前 10 块后）
  - 最多连续 2 个没有道路
  - 障碍物概率：10%（不能连续出现）
  - 怪物概率：5%（不能连续出现，不在道路段边缘）
  - 道具概率：3%（固定概率，不受其他对象影响）

### 玩家系统 (`player.go`)
- **移动参数**:
  - 左右移动速度：5.5 像素/帧
  - 碰撞盒尺寸：60 × 346 像素
  - 原点位置：底部中心
  - 重力加速度：0.6 像素/帧²
  - 跳跃初始速度：-18.0 像素/帧
- **飞行状态**:
  - 飞行速度：15.0 像素/帧（向右）
  - 飞行持续时间：300 帧
  - 飞行时无视碰撞，不受重力影响
  - 飞行时 Y 坐标固定为 240
  - 飞行时 X 坐标设置为屏幕中心（相机位置 + 屏幕宽度/2）
- **死亡机制**:
  - 碰撞盒完全移出屏幕时死亡
  - 触碰到怪物时立即死亡
  - 死亡后播放死亡动画和音效
  - 死亡后停止背景音乐和相机移动

### 障碍物系统 (`obstacle.go`)
- **ObstacleType 枚举**:
  - `ObstacleTypeGrass`: 道路（草地）
  - `ObstacleTypeObstacle`: 障碍物
  - `ObstacleTypeMonster`: 怪物
  - `ObstacleTypeTool`: 道具
- **碰撞规则**:
  - 道路和障碍物：阻挡水平移动，支持站立
  - 怪物：任何接触都会导致玩家死亡（不阻挡移动）
  - 道具：不阻挡移动，触碰后触发飞行状态并移除

### 动画系统 (`animation.go`)
- **动画状态**:
  - `StateIdle`: 闲置动画（39 帧，循环，20 FPS）
  - `StateMove`: 移动动画（26 帧，循环，20 FPS）
  - `StateJumpBefore`: 起跳动画（10 帧，播放一次，27 FPS）
  - `StateJumpLoop`: 跳跃循环（1 帧，循环，1 FPS）
  - `StateJumpEnd`: 落地动画（7 帧，播放一次，27 FPS）
  - `StateDie`: 死亡动画（30 帧，播放一次，20 FPS）
  - `StateFly`: 飞行动画（1 帧，循环，20 FPS）
- **动画特性**:
  - 所有动画缩放为原尺寸的 1/2
  - 支持水平翻转（向左移动时）
  - 支持每动画独立的 FPS 和原点 Y 偏移
  - 动画状态机由 Player 类控制

### 音频系统 (`audio.go`)
- **背景音乐**: `res/audio/bgm.mp3`（循环播放，音量 0.4）
- **跳跃音效**: `res/audio/jump.wav`（音量 1.0）
- **死亡音效**: `res/audio/die.mp3`（音量 1.0）
- **音频管理器**: 统一管理音频上下文和播放器，文件读取到内存避免关闭错误

### 相机系统 (`game.go`)
- **移动方式**: 自动向右移动
- **移动速度**:
  - 正常状态：5.0 像素/帧
  - 飞行状态：15.0 像素/帧（与玩家飞行速度同步）
- **移动范围**: 0 ～ 地图总宽度 - 屏幕宽度
- **停止条件**: 玩家死亡时停止移动

### 碰撞检测系统 (`collision.go`)
- **CollisionBox 接口**: 定义碰撞盒接口
- **CheckCollision 函数**: AABB 矩形碰撞检测
- **碰撞方向**:
  - 向下：检查是否站在障碍物上
  - 水平：检查是否被障碍物阻挡（怪物和道具除外）
  - 向上：允许穿越（不检查）

## 资源文件
- `res/image/`: 游戏图片资源
  - `bg.png`: 背景图片（无限滚动）
  - `grass.png`: 道路块（120×120）
  - `obstacle.png`: 障碍物图片
  - `most_pix.png`: 怪物图片
  - `tool.png`: 道具图片
  - `idle.png`: 玩家闲置动画（39 帧）
  - `move.png`: 玩家移动动画（26 帧）
  - `jump_before.png`: 起跳动画（10 帧）
  - `jump_loop.png`: 跳跃循环（1 帧）
  - `jump_end.png`: 落地动画（7 帧）
  - `die.png`: 死亡动画（30 帧）
  - `fly.png`: 飞行动画（1 帧）
- `res/audio/`: 游戏音频资源
  - `bgm.mp3`: 背景音乐
  - `jump.wav`: 跳跃音效
  - `die.mp3`: 死亡音效

## 游戏机制

### 玩家控制
- **左右移动**: 方向键 ← → 或 A D 键
- **跳跃**: 空格键（仅在地面上时）

### 游戏流程
1. 游戏开始：玩家位于屏幕中心，相机自动向右移动
2. 正常游戏：玩家可以移动、跳跃，避开障碍物和怪物
3. 道具收集：触碰道具后进入飞行状态（300 帧）
4. 死亡判定：碰撞盒完全移出屏幕或触碰到怪物
5. 游戏结束：死亡后停止背景音乐和相机移动

## 代码规范
- 遵循 Go 语言最佳实践
- 使用中文注释
- 错误处理要完整
- 代码结构清晰，职责单一
- 使用枚举类型替代多个布尔值
- 资源文件读取到内存避免文件关闭错误
- 使用帧计数器而非时间类进行状态管理

## 常量定义位置
- `game.go`: 窗口尺寸、地图单元宽度、相机速度
- `player.go`: 玩家移动速度、碰撞盒尺寸、重力、跳跃速度、飞行参数
- `animation.go`: 游戏帧率
- `audio.go`: 音频采样率、音量设置
